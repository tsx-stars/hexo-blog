<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><meta name="referrer" content="no-referrer"><link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="卡布奇诺" href="http://tangsx.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="卡布奇诺" href="http://tangsx.com/atom.xml"><link rel="alternate" type="application/json" title="卡布奇诺" href="http://tangsx.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="前端,知识库,webpack"><link rel="canonical" href="http://tangsx.com/web/%E7%9F%A5%E8%AF%86%E5%BA%93/webpack4-%E4%B8%8A/"><title>webpack4 - 上 - 知识库 - 前端 | stars = 卡布奇诺 = 从来没在真正的绝境，只有心灵的迷途</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">webpack4 - 上</h1><div class="meta"><span class="item" title="创建时间：2020-01-04 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2020-01-04T00:00:00+08:00">2020-01-04</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>9.4k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>9 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">stars</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclgrvbd6j20zk0m8qv5.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclfdu6exj20zk0m87hw.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclize41wj20zk0m87gk.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclhfehz7j20zk0m8u0x.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclh0m9pdj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/web/" itemprop="item" rel="index" title="分类于 前端"><span itemprop="name">前端</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/web/%E7%9F%A5%E8%AF%86%E5%BA%93/" itemprop="item" rel="index" title="分类于 知识库"><span itemprop="name">知识库</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tangsx.com/web/%E7%9F%A5%E8%AF%86%E5%BA%93/webpack4-%E4%B8%8A/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/tangsx.png"><meta itemprop="name" content="小兴"><meta itemprop="description" content="从来没在真正的绝境，只有心灵的迷途, 世上无难事，只要肯放弃"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="卡布奇诺"></span><div class="body md" itemprop="articleBody"><blockquote><p>本文作者来自 <span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL29yZy9odWEtZXItamllLWppYW4td2VuLWppLXpodS10dWFuLWR1aS05Mi9hY3Rpdml0aWVz">华尔街见闻技术团队</span> - <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1BhbkppYUNoZW4=">花裤衩</span></p></blockquote><p>前几天 webpack 作者 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nva3Jh">Tobias Koppers</span> 发布了一篇新的文章 <span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL3dlYnBhY2svd2VicGFjay00LTAtdG8tNC0xNi1kaWQteW91LWtub3ctNzFlMjVhNTdmYTZi">webpack 4.0 to 4.16: Did you know?</span>(需翻墙)，总结了一下 <code>webpack 4</code> 发布以来，做了哪些调整和优化。<br>并且说自己正在着手开发 <code>webpack 5</code> 。</p><blockquote><p>Oh you are still on webpack 3. I’m sorry, what is blocking you? We already working on webpack 5, so your stack might be outdated soon…</p></blockquote><p>翻译成中文就是：</p><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/27/164db1a2e089c151?w=690&amp;h=200&amp;f=jpeg&amp;s=22433" alt=""></p><p>正好我也在使用一个文档生成工具 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BlZHJvbmF1Y2svZG9jeg==">docz</span> (安利一波) 也最低需要 <code>webpack 4+</code> ，新版 <code>webpack</code> 性能提高了不少，而且 <code>webpack 4</code> 都已经发布五个多月了，想必应该已经没什么坑了，应该可以安心的按照别人写的升级攻略升级了。之前一直迟迟不升级完全是被去年被 <code>webpack 3</code> 坑怕了。它在 <code>code splitting</code> 的情况下 <code>CommonsChunkPlugin</code> 会完全失效。过了好一段时间才修复，欲哭无泪。</p><p>所以这次我等了快大半年才准备升级到 <code>webpack 4</code> <strong>但万万没想到还是遇到了不少的问题！</strong> 有很多之前遗留的问题还是没有很好地解决。但最主要的问题还是它的文档有所欠缺，已经废除了的东西如 <code>commonsChunkPlugin</code> 还在官方文档中到处出现，很多重要的东西却一笔带过，甚至没写，需要用户自己去看源码才能解决。</p><p>还比如在 <code>v4.16.0</code> 版本中废除了 <code>optimization.occurrenceOrder</code> 、 <code>optimization.namedChunks</code> 、 <code>optimization.hashedModuleIds</code> 、 <code>optimization.namedModules</code> 这几个配置项，替换成了 <code>optimization.moduleIds</code> 和 <code>optimization.chunkIds</code> ，但文档完中全没有任何体现，所以你在新版本中还按照文档那样配置其实是没有任何效果的。</p><p>最新最完整的文档还是看他项目的配置<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2svd2VicGFjay9ibG9iL21hc3Rlci9zY2hlbWFzL1dlYnBhY2tPcHRpb25zLmpzb24="> WebpackOptions.json</span>，强烈建议遇到不清楚的配置项可以看这个，因为它一定保证是和最新代码同步的。</p><p>吐槽了这么多，我们言归正传。由于本次手摸手篇幅有些长，所以拆解成了上下两篇文章：</p><ul><li>上篇 -- 就是普通的在 <code>webpack 3</code> 的基础上升级，要做哪些操作和遇到了哪些坑</li><li>下篇 -- 是在 <code>webpack 4</code> 下怎么合理的打包和拆包，并且如何最大化利用 <code>long term caching</code></li></ul><p><strong>本文章不是手摸手从零教你 webpack 配置，所以并不会讲太多很基础的配置问题</strong>。比如如何处理 css 文件，如何配置 webpack-dev-server，讲述 file-loader 和 url-loader 之间的区别等等，有需求的推荐看 <span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9jb25jZXB0cy8=">官方文档</span> 或者 <span class="exturl" data-url="aHR0cHM6Ly9zdXJ2aXZlanMuY29tL3dlYnBhY2svZGV2ZWxvcGluZy93ZWJwYWNrLWRldi1zZXJ2ZXIv">survivejs</span> 出的一个系列教程。或者推荐看我司的另一篇 wbepack 入门文章，已同步到 webpack4 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dhbGxzdHJlZXRjbi93ZWJwYWNrLWFuZC1zcGEtZ3VpZGU=">传送门</span>。</p><h2 id="升级篇"><a class="anchor" href="#升级篇">#</a> 升级篇</h2><h3 id="前言"><a class="anchor" href="#前言">#</a> 前言</h3><p>我一直认为模仿和借鉴是学习一个新东西最高效的方法。所以我建议还是通过借鉴一些成熟的 webpack 配置比较好。比如你项目是基于 react 生态圈的话可以借鉴 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2NyZWF0ZS1yZWFjdC1hcHA=">create-react-app</span> ，下载之后 <code>npm run eject</code> 就可以看到它详细的 webpack 配置了。vue 的话由于新版 <code>vue cli</code> 不支持 <code>eject</code> 了，而且改用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEtbmV1dHJpbm8vd2VicGFjay1jaGFpbg==">webpack-chain</span> 来配置，所以借鉴起来可能会不太方便，主要配置 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1jbGkvdHJlZS9kZXYvcGFja2FnZXMvQHZ1ZS9jbGktc2VydmljZS9saWIvY29uZmln">地址</span>。觉得麻烦的话你可以直接借鉴 <code>vue-element-admin</code> 的 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1BhbkppYUNoZW4vdnVlLWVsZW1lbnQtYWRtaW4vcHVsbC84ODk=">配置</span>。或者你想自己发挥，你可以借鉴 webpack 官方的各种 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2svd2VicGFjay90cmVlL21hc3Rlci9leGFtcGxlcw==">examples</span>，来组合你的配置。</p><h3 id="升级-webpack"><a class="anchor" href="#升级-webpack">#</a> 升级 webpack</h3><p>首先将 webpack 升级到 4 之后，直接运行 <code>webpack --xxx</code> 是不行的，因为新版本将命令行相关的东西单独拆了出去封装成了 <code>webpack-cli</code> 。会报如下错误：</p><blockquote><p>The CLI moved into a separate package: webpack-cli.<br>Please install <code>webpack-cli</code> in addition to webpack itself to use the CLI.</p></blockquote><p>所有你需要安装 <code>npm install webpack-cli -D -S</code> 。你也可将它安装在全局。</p><p>同时新版 webpack 需要 <code>Node.js 的最低支持版本为 6.11.5</code> 不要忘了升级。如果还需要维护老项目可以使用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NyZWF0aW9uaXgvbnZt">nvm</span> 来做一下 node 版本管理。</p><p><strong>升级所有依赖</strong></p><p>因为 <code>webpack4</code> 改了 它的 <code>hook</code> api ，所以所有的 <code>loaders</code> 、 <code>plugins</code> 都需要升级才能够适配。</p><p>可以使用命令行 <code>npm outdated</code> ，列出所以可以更新的包。免得再一个个去 <code>npm</code> 找相对于的可用版本了。</p><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/27/164da832e18a97ef?w=890&amp;h=346&amp;f=jpeg&amp;s=105563" alt=""></p><p>反正把 <code>devDependencies</code> 的依赖都升级一下，总归不会有错。</p><h3 id="带来的变化"><a class="anchor" href="#带来的变化">#</a> 带来的变化</h3><p>其实这次升级带来了不少改变，但大部分其实对于普通用户来说是不需要关注的，比如这次升级带来的功能 <code>SideEffects</code> 、 <code>Module Type’s Introduced</code> 、 <code>WebAssembly Support</code> ，基本平时是用不到的。我们主要关注那些对我们影响比较大的改动如： <code>optimization.splitChunks</code> 代替原有的 <code>CommonsChunkPlugin</code> (下篇文章会着重介绍)，和 <code>Better Defaults-mode</code> 更好的默认配置，这是大家稍微需要关注一下的。</p><table><thead><tr><th style="text-align:left">废弃项</th><th style="text-align:left">替代项 (optimization)</th><th style="text-align:center">主要功能</th></tr></thead><tbody><tr><td style="text-align:left">UglifyjsWebpackPlugin</td><td style="text-align:left">.minmize</td><td style="text-align:center">压缩优化</td></tr><tr><td style="text-align:left">ModuleConcatenationPlugin</td><td style="text-align:left">.opconcatenateModules</td><td style="text-align:center">Scope hoisting</td></tr><tr><td style="text-align:left">CommonsChunkPlugin</td><td style="text-align:left">.splitChunks/.runtimeChunk</td><td style="text-align:center">Code splitting</td></tr><tr><td style="text-align:left">NoEmitOnErrorsPlugin</td><td style="text-align:left">noEmitOnErrors</td><td style="text-align:center">编译出现错误，跳过输出阶段</td></tr></tbody></table><blockquote><p>如果想进一步了解 <code>Tree Shaking</code> 和 <code>SideEffects</code> 的可见文末拓展阅读。<br><em>上图参考 <span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNTQwNzY0Mg==">Webpack 4 进阶</span></em></p></blockquote><h3 id="默认配置"><a class="anchor" href="#默认配置">#</a> 默认配置</h3><p>webpack 4 引入了 <code>零配置</code> 的概念，被 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhcmNlbC1idW5kbGVyL3BhcmNlbA==">parcel</span> 刺激到了。 不管效果怎样，这改变还是值得称赞的。</p><blockquote><p>最近又新出了 <span class="exturl" data-url="aHR0cDovL2Zhc3RwYWNrLmlvLw==">Fastpack</span> 可以关注一下。</p></blockquote><p>言归正题，我们来看看 webpack 默认帮我们做了些什么？</p><p><code>development</code> 模式下，默认开启了 <code>NamedChunksPlugin</code> 和 <code>NamedModulesPlugin</code> 方便调试，提供了更完整的错误信息，更快的重新编译的速度。</p><figure class="highlight diff"><figcaption data-lang="diff"></figcaption><table><tr><td data-num="1"></td><td><pre>module.exports = &#123;</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> mode: 'development'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> devtool: 'eval',</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token prefix deleted">-</span> plugins: [</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token prefix deleted">-</span>   new webpack.NamedModulesPlugin(),</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token prefix deleted">-</span>   new webpack.NamedChunksPlugin(),</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token prefix deleted">-</span>   new webpack.DefinePlugin(&#123; "process.env.NODE_ENV": JSON.stringify("development") &#125;),</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token prefix deleted">-</span> ]</pre></td></tr><tr><td data-num="9"></td><td><pre>&#125;</pre></td></tr></table></figure><p><code>production</code> 模式下，由于提供了 <code>splitChunks</code> 和 <code>minimize</code> ，所以基本零配置，代码就会自动分割、压缩、优化，同时 webpack 也会自动帮你 <code>Scope hoisting</code> 和 <code>Tree-shaking</code> 。</p><figure class="highlight diff"><figcaption data-lang="diff"></figcaption><table><tr><td data-num="1"></td><td><pre>module.exports = &#123;</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>  mode: 'production',</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>  plugins: [</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token prefix deleted">-</span>    new UglifyJsPlugin(/* ... */),</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token prefix deleted">-</span>    new webpack.DefinePlugin(&#123; "process.env.NODE_ENV": JSON.stringify("production") &#125;),</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token prefix deleted">-</span>    new webpack.optimize.ModuleConcatenationPlugin(),</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token prefix deleted">-</span>    new webpack.NoEmitOnErrorsPlugin()</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token prefix deleted">-</span>  ]</pre></td></tr><tr><td data-num="9"></td><td><pre>&#125;</pre></td></tr></table></figure><p>webpack 一直以来最饱受诟病的就是其配置门槛极高，配置内容极其复杂和繁琐，容易让人从入门到放弃，而它的后起之秀如 rollup、parcel 等均在配置流程上做了极大的优化，做到开箱即用，所以 <code>webpack 4</code> 也从中借鉴了不少经验来提升自身的配置效率。<strong>愿世间再也不需要 webpack 配置工程师</strong>。</p><h2 id="html-webpack-plugin"><a class="anchor" href="#html-webpack-plugin">#</a> html-webpack-plugin</h2><p>用最新版本的的 <code>html-webpack-plugin</code> 你可能还会遇到如下的错误：</p><p><code>throw new Error('Cyclic dependency' + nodeRep)</code></p><p>产生这个 bug 的原因是循环引用依赖，如果你没有这个问题可以忽略。</p><p>目前解决方案可以使用 Alpha 版本， <code>npm i --save-dev html-webpack-plugin@next</code></p><p>或者加入 <code>chunksSortMode: 'none'</code> 就可以了。</p><p>但仔细查看文档发现设置成 <code>chunksSortMode: 'none'</code> 这样是会有问题的。</p><blockquote><p>Allows to control how chunks should be sorted before they are included to the HTML.</p></blockquote><p>这属性会决定你 chunks 的加载顺序，如果设置为 <code>none</code> ，你的 chunk 加载在页面中加载的顺序就不能够保证了，可能会出现样式被覆盖的情况。比如我在 <code>app.css</code> 里面修改了一个第三方库 <code>element-ui</code> 的样式，通过加载顺序的先后来覆盖它，但由于设置为了 <code>none</code> ，打包出来的结果变成了这样：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/app.8945fbfc.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/chunk-elementUI.2db88087.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr></table></figure><p><code>app.css</code> 被先加载了，之前写的样式覆盖就失效了，除非你使用 <code>important</code> 或者其它 css 权重的方式覆盖它，但这明显是不太合理的。<br><code>vue-cli</code> 正好也有这个相关 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1jbGkvaXNzdWVzLzE5NzgjaXNzdWVjb21tZW50LTQwOTI2NzQ4NA==">issue</span>，尤雨溪也在不使用 <code>@next</code> 版本的基础上 hack 了它，有兴趣的可以自己研究一下，本人在项目中直接使用了 <code>@next</code> 版本，也没遇到其它什么问题（除了不兼容 webpack 的 <code>prefetch/preload</code> 相关 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phbnRpbW9uL2h0bWwtd2VicGFjay1wbHVnaW4vaXNzdWVzLzkzNA==">issue</span>）。两种方案都可以，自行选择。</p><p>其它 <code>html-webpack-plugin</code> 的配置和之前使用没有什么区别。</p><h2 id="mini-css-extract-plugin"><a class="anchor" href="#mini-css-extract-plugin">#</a> mini-css-extract-plugin</h2><h3 id="与-extract-text-webpack-plugin-区别"><a class="anchor" href="#与-extract-text-webpack-plugin-区别">#</a> 与 extract-text-webpack-plugin 区别</h3><p>由于 <code>webpack4</code> 对 css 模块支持的完善以及在处理 css 文件提取的方式上也做了些调整，所以之前我们一直使用的 <code>extract-text-webpack-plugin</code> 也完成了它的历史使命，将让位于 <code>mini-css-extract-plugin</code> 。</p><p>使用方式也很简单，大家看着 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9taW5pLWNzcy1leHRyYWN0LXBsdWdpbiNtaW5pbWFsLWV4YW1wbGU=">文档</span> 抄就可以了。</p><p>它与 <code>extract-text-webpack-plugin</code> 最大的区别是：它在 <code>code spliting</code> 的时候会将原先内联写在每一个 js <code>chunk bundle</code> 的 css，单独拆成了一个个 css 文件。</p><p>原先 css 是这样内联在 js 文件里的：<br><img data-src="https://user-gold-cdn.xitu.io/2018/7/24/164cb85b234d224a?w=2534&amp;h=98&amp;f=jpeg&amp;s=50714" alt=""></p><p>将 css 独立拆包最大的好处就是 js 和 css 的改动，不会影响对方。比如我改了 js 文件并不会导致 css 文件的缓存失效。而且现在它自动会配合 <code>optimization.splitChunks</code> 的配置，可以自定义拆分 css 文件，比如我单独配置了 <code>element-ui</code> 作为单独一个 <code>bundle</code> , 它会自动也将它的样式单独打包成一个 css 文件，不会像以前默认将第三方的 css 全部打包成一个几十甚至上百 KB 的 <code>app.xxx.css</code> 文件了。</p><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/24/164cbd49dc148656?w=516&amp;h=254&amp;f=png&amp;s=73856" alt=""></p><h3 id="压缩与优化"><a class="anchor" href="#压缩与优化">#</a> 压缩与优化</h3><p>打包 css 之后查看源码，我们发现它并没有帮我们做代码压缩，这时候需要使用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05NRlIvb3B0aW1pemUtY3NzLWFzc2V0cy13ZWJwYWNrLXBsdWdpbg==">optimize-css-assets-webpack-plugin</span> 这个插件，它不仅能帮你压缩 css 还能优化你的代码。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 配置</span></pre></td></tr><tr><td data-num="2"></td><td><pre>optimization<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/30/164e93dc299d7062?w=1778&amp;h=764&amp;f=jpeg&amp;s=198182" alt=""></p><p>如上图测试用例所示，由于 <code>optimize-css-assets-webpack-plugin</code> 这个插件默认使用了 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nzc25hbm8vY3NzbmFubw==">cssnano</span> 来作 css 优化，<br>所以它不仅压缩了代码、删掉了代码中无用的注释、还去除了冗余的 css、优化了 css 的书写顺序，优化了你的代码 <code>margin: 10px 20px 10px 20px;</code> =&gt; <code>margin:10px 20px;</code> 。同时大大减小了你 css 的文件大小。更多优化的细节见<span class="exturl" data-url="aHR0cHM6Ly9jc3NuYW5vLmNvL2d1aWRlcy9vcHRpbWlzYXRpb25z">文档</span>。</p><h3 id="contenthash"><a class="anchor" href="#contenthash">#</a> contenthash</h3><p>但使用 <code>MiniCssExtractPlugin</code> 有一个需求特别注意的地方，在默认文档中它是这样配置的：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// Options similar to the same options in webpackOptions.output</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// both options are optional</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  filename<span class="token operator">:</span> devMode <span class="token operator">?</span> <span class="token string">'[name].css'</span> <span class="token operator">:</span> <span class="token string">'[name].[hash].css'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  chunkFilename<span class="token operator">:</span> devMode <span class="token operator">?</span> <span class="token string">'[id].css'</span> <span class="token operator">:</span> <span class="token string">'[id].[hash].css'</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>简单说明一下： <code>filename</code> 是指在你入口文件 <code>entry</code> 中引入生成出来的文件名，而 <code>chunkname</code> 是指那些未被在入口文件 <code>entry</code> 引入，但又通过按需加载（异步）模块的时候引入的文件。</p></blockquote><p>在 <strong>copy</strong> 如上代码使用之后发现情况不对！每次改动一个 <code>xx.js</code> 文件，它对应的 css 虽然没做任何改动，但它的 文件 hash 还是会发生变化。仔细对比发现原来是 <code>hash</code> 惹的祸。 <code>6.f3bfa3af.css</code> =&gt; <code>6.40bc56f6.css</code></p><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/24/164cbe27801ebf69?w=1214&amp;h=308&amp;f=png&amp;s=162463" alt=""></p><p>但我这是根据官方文档来写的！为什么还有问题！后来在文档的<strong>最最最</strong>下面发下了这么一段话！</p><blockquote><p>For long term caching use filename: <code>[contenthash].css</code> . Optionally add [name].</p></blockquote><p>非常的不理解，这么关键的一句话会放在 <code>Maintainers</code> 还后面的地方，默认写在配置里面提示大家不是更好？有热心群众已经开了一个 <code>pr</code> ，将文档默认配置为 <code>contenthash</code> 。 <code>chunkhash</code> =&gt; <code>contenthash</code> 相关 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2svd2VicGFjay5qcy5vcmcvaXNzdWVzLzIwOTY=">issue</span>。</p><p>这个真的蛮过分的，稍不注意就会让自己的 css 文件缓存无效。而且很多用户平时修改代码的时候都不会在意自己最终打包出来的 <code>dist</code> 文件夹中到底有哪些变化。所以这个问题可能就一直存在了。浪费了多少资源！人艰不拆！大家觉得 webpack 难用不是没道理的。</p><h3 id="这里再简单说明一下几种-hash-的区别"><a class="anchor" href="#这里再简单说明一下几种-hash-的区别">#</a> 这里再简单说明一下几种 hash 的区别：</h3><ul><li><strong>hash</strong></li></ul><p><code>hash</code> 和每次 <code>build</code> 有关，没有任何改变的情况下，每次编译出来的 <code>hash</code> 都是一样的，但当你改变了任何一点东西，它的 <code>hash</code> 就会发生改变。</p><p>简单理解，你改了任何东西， <code>hash</code> 就会和上次不一样了。</p><ul><li><strong>chunkhash</strong></li></ul><p><code>chunkhash</code> 是根据具体每一个模块文件自己的的内容包括它的依赖计算所得的 <code>hash</code> ，所以某个文件的改动只会影响它本身的 <code>hash</code> ，不会影响其它文件。</p><ul><li><strong>contenthash</strong></li></ul><p>它的出现主要是为了解决，让 <code>css</code> 文件不受 <code>js</code> 文件的影响。比如 <code>foo.css</code> 被 <code>foo.js</code> 引用了，所以它们共用相同的 <code>chunkhash</code> 值。但这样子是有问题的，如果 <code>foo.js</code> 修改了代码， <code>css</code> 文件就算内容没有任何改变，由于是该模块的 <code>hash</code> 发生了改变，其 <code>css</code> 文件的 <code>hash</code> 也会随之改变。</p><p>这个时候我们就可以使用 <code>contenthash</code> 了，保证即使 <code>css</code> 文件所处的模块里有任何内容的改变，只要 css 文件内容不变，那么它的 <code>hash</code> 就不会发生变化。</p><p><code>contenthash</code> 你可以简单理解为是 <code>moduleId</code> + <code>content</code> 所生成的 <code>hash</code> 。</p><h2 id="热更新速度"><a class="anchor" href="#热更新速度">#</a> 热更新速度</h2><p>其实相对 webpack 线上打包速度，我更关心的本地开发热更新速度，毕竟这才是和我们每一个程序员每天真正打交道的东西，打包一般都会扔给 <code>CI</code> 自动执行，而且一般项目每天也不会打包很多次。</p><p><code>webpack 4</code> 一直说自己更好的利用了 <code>cache</code> 提高了编译速度，但实测发现是有一定的提升，但当你一个项目，路由懒加载的页面多了之后，50 + 之后，热更新慢的问题会很明显，之前的<span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81OTViNGQ3NzZmYjlhMDZiYmU3ZGJhNTYjaGVhZGluZy0x">文章</span>中也提到过这个问题，原以为新版本会解决这个问题，但并没有。</p><p>不过你首先要排斥你的热更新慢不是，如：</p><ul><li>没有使用合理的 <span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9jb25maWd1cmF0aW9uL2RldnRvb2wvI2RldnRvb2w=">Devtool</span> souce map 导致</li><li>没有正确使用 <span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9jb25maWd1cmF0aW9uL21vZHVsZS8jcnVsZS1pbmNsdWRl">exclude/include</span> 处理了不需要处理的如 <code>node_modules</code></li><li>在开发环境不要压缩代码 <code>UglifyJs</code> 、提取 css、babel polyfill、计算文件 hash 等不需要的操作</li></ul><p><strong>旧方案</strong></p><p>最早的方案是开发环境中不是用路由懒加载了，只在线上环境中使用。封装一个 <code>_import</code> 函数，通过环境变区分是否需要懒加载。</p><p>开发环境：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">file</span> <span class="token operator">=></span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/views/'</span> <span class="token operator">+</span> file <span class="token operator">+</span> <span class="token string">'.vue'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default</pre></td></tr></table></figure><p>生成环境：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">file</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/'</span> <span class="token operator">+</span> file <span class="token operator">+</span> <span class="token string">'.vue'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>但由于 webpack <code>import</code> 实现机制问题，会产生一定的副作用。如上面的写法就会导致 <code>@/views/</code> 下的 所有 <code>.vue</code> 文件都会被打包。不管你是否被依赖引用了，会多打包一些可能永远都用不到 js 代码。 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1BhbkppYUNoZW4vdnVlLWVsZW1lbnQtYWRtaW4vaXNzdWVzLzI5Mg==">相关 issue</span></p><p>目前新的解决方案思路还是一样的，只在生成模式中使用路由懒加载，本地开发不使用懒加载。但换了一种没副作用的实现方式。</p><p><strong>新方案</strong></p><p>使用 <code>babel</code> 的 <code>plugins</code> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FpcmJuYi9iYWJlbC1wbHVnaW4tZHluYW1pYy1pbXBvcnQtbm9kZQ==">babel-plugin-dynamic-import-node</span>。它只做一件事就是：将所有的 <code>import()</code> 转化为 <code>require()</code> ，这样就可以用这个插件将所有异步组件都用同步的方式引入了，并结合 <span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvdXNhZ2UvYmFiZWxyYy8jZW52LW9wdGlvbg==">BABEL_ENV</span> 这个 <code>bebel</code> 环境变量，让它只作用于开发环境下。将开发环境中所有 <code>import()</code> 转化为 <code>require()</code> ，这种方案解决了之前重复打包的问题，同时对代码的侵入性也很小，你平时写路由的时候只需要按照官方<span class="exturl" data-url="aHR0cHM6Ly9yb3V0ZXIudnVlanMub3JnL3poL2d1aWRlL2FkdmFuY2VkL2xhenktbG9hZGluZy5odG1s">文档</span>路由懒加载的方式就可以了，其它的都交给 <code>babel</code> 来处理，当你不想用这个方案的时候，也只需要将它从 <code>babel</code> 的 <code>plugins</code> 中移除就可以了。</p><p><strong>具体代码：</strong></p><p>首先在 <code>package.json</code> 中增加 <code>BABEL_ENV</code></p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"BABEL_ENV=development webpack-dev-server XXXX"</span></pre></td></tr></table></figure><p>接着在 <code>.babelrc</code> 只能加入 <code>babel-plugin-dynamic-import-node</code> 这个 <code>plugins</code> ，并让它只有在 <code>development</code> 模式中才生效。</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"development"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dynamic-import-node"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>之后就大功告成了，路由只要像平时一样写就可以了。<span class="exturl" data-url="aHR0cHM6Ly9wYW5qaWFjaGVuLmdpdGh1Yi5pby92dWUtZWxlbWVudC1hZG1pbi1zaXRlL3poL2d1aWRlL2FkdmFuY2VkL2xhenktbG9hZGluZy5odG1sIyVFNiU5NiVCMCVFNiU5NiVCOSVFNiVBMSU4OA==">文档</span></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span> path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/login/index'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这样能大大提升你热更新的速度。基本两百加页面也能在 <code>2000ms</code> 的热跟新完成，基本做到无感刷新。当然你的项目本身就不大页面也不多，完全没必要搞这些。<strong>当你的页面变化跟不是你写代码速度的时候再考虑也不迟。</strong></p><h2 id="打包速度"><a class="anchor" href="#打包速度">#</a> 打包速度</h2><p><code>webpack 4</code> 在项目中实际测了下，普遍能提高 20%~30% 的打包速度。</p><p>本文不准备太深入的讲解这部分内容，详细的打包优化速度可以参考<span class="exturl" data-url="aHR0cHM6Ly9zbGFjay5lbmdpbmVlcmluZy9rZWVwLXdlYnBhY2stZmFzdC1hLWZpZWxkLWd1aWRlLWZvci1iZXR0ZXItYnVpbGQtcGVyZm9ybWFuY2UtZjU2YTU5OTVlOGYx"> slack 团队的这篇文章</span>，掘金还有<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpdHUvZ29sZC1taW5lci9ibG9iL21hc3Rlci9UT0RPL2tlZXAtd2VicGFjay1mYXN0LWEtZmllbGQtZ3VpZGUtZm9yLWJldHRlci1idWlsZC1wZXJmb3JtYW5jZS5tZA==">译文</span>.</p><p>这里有几个建议来帮你加速 webpack 的打包速度。</p><p>首先你需要知道你目前打包慢，是慢在哪里。</p><p>我们可以用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0ZXBoZW5jb29rZGV2L3NwZWVkLW1lYXN1cmUtd2VicGFjay1wbHVnaW4jcmVhZG1l">speed-measure-webpack-plugin</span> 这个插件，它能监控 webpack 每一步操作的耗时。如下图：</p><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/31/164eee200ebc1911?w=554&amp;h=492&amp;f=jpeg&amp;s=92342" alt=""></p><p>可以看出其实大部分打包花费的时间是在 <code>Uglifyjs</code> 压缩代码。和前面的提升热更新的切入点差不多，查看 <code>source map</code> 的正确与否， <code>exclude/include</code> 的正确使用等等。</p><p>使用新版的 <code>UglifyJsPlugin</code> 的时候记住可以加上 <code>cache: true</code> 、 <code>parall: true</code> ，可以提搞代码打包压缩速度。更多配置可以参考 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi91Z2xpZnlqcy13ZWJwYWNrLXBsdWdpbg==">文档</span> 或者 vue-cli 的 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1jbGkvYmxvYi9kZXYvcGFja2FnZXMvQHZ1ZS9jbGktc2VydmljZS9saWIvY29uZmlnL3VnbGlmeU9wdGlvbnMuanM=">配置</span>。</p><p>编译的时候还有还有一个很慢的原因是那些第三方库。比如 <code>echarts</code> 、 <code>element-ui</code> 其实都非常的大，比如 <code>echarts</code> 打包完也还有 775kb。所以你想大大提高编译速度，可以将这些第三方库 <code>externals</code> 出去，使用 <code>script</code> 的方式引入，或者使用 <code>dll</code> 的方式打包。经测试一般如 <code>echarts</code> 这样大的包可以节省十几秒到几十秒不等。</p><p>还有可以使用一些并行执行 webpack 的库：如<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RyaXZhZ28vcGFyYWxsZWwtd2VicGFjaw=="> parallel-webpack</span>、<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtaXJlaC9oYXBweXBhY2s=">happypack</span>。</p><p><strong>顺便说一下，升级一下 <code>node</code> 可能有惊喜。前不久将 <code>CI</code> 里面的 node 版本依赖从 <code>6.9.2</code> =&gt; <code>8.11.3</code> ，打包速度直接提升了一分多钟。</strong></p><p>总之我觉得打包时间控制在差不多的范围内就可以了，没必要过分的优化。可能你研究了半天，改了一堆参数发现其实也就提升了几秒，但维护成本上去了，得不偿失。还不如升级 node、升级 webpack、升级你的编译环境的硬件水平来的实在和简单。</p><p>比如我司 <code>CI</code> 使用的是腾讯云普通的的 8 核 16g 的机器，这个项目也是一个很大的后台管理项目 200 + 页面，引用了很多第三方的库，但没有使用什么 <code>happypack</code> 、 <code>dll</code> ，只是用了最新版的 <code>webpack4</code> ， <code>node@8.11.3</code> 。<br>编译速度稳定在两分多钟，完全不觉得有什么要优化的必要。</p><p><img data-src="https://user-gold-cdn.xitu.io/2018/7/29/164e5366dd1d9dec?w=896&amp;h=236&amp;f=jpeg&amp;s=22563" alt=""></p><h2 id="tree-shaking"><a class="anchor" href="#tree-shaking">#</a> Tree-Shaking</h2><p>这其实并不是 webpack 4 才提出来的概念，最早是 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvbGx1cC9yb2xsdXA=">rollup</span> 提出来并实现的，后来在 webpack 2 中就实现了，本次在 webpack 4 只是增加了 <code>JSON Tree Shaking</code> 和 <code>sideEffects</code> 能让你能更好的<strong>摇</strong>。</p><p>不过这里还是要提一下，默认 webpack 是支持 <code>Tree-Shaking</code> 的，但在你的项目中可能会因为 <code>babel</code> 的原因导致它失效。</p><p>因为 <code>Tree Shaking</code> 这个功能是基于 <code>ES6 modules</code> 的静态特性检测，来找出未使用的代码，所以如果你使用了 babel 插件的时候，如：<span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvZW4vYmFiZWwtcHJlc2V0LWVudi8=">babel-preset-env</span>，它默认会将模块打包成 <code>commonjs</code> ，这样就会让 <code>Tree Shaking</code> 失效了。</p><p>其实在 webpack 2 之后它自己就支持模块化处理。所以只要让 babel 不 <code>transform modules</code> 就可以了。配置如下：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// .babelrc</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token string">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      modules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token operator">...</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>顺便说一下都 8102 年了，请不要在使用 <code>babel-preset-esxxxx</code> 系列了，请用 <code>babel-preset-env</code> ，相关文章 <span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yOTUwNjY4NQ==">再见，babel-preset-2015</span>。</p><p>拓展阅读：</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YjVkNmQ2ZjZmYjlhMDRmZWE1OGFhYmM=">手摸手，带你用合理的姿势使用 webpack4 （下）</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dhbGxzdHJlZXRjbi93ZWJwYWNrLWFuZC1zcGEtZ3VpZGU=">Webpack 4 和单页应用入门</span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80MDA1MjE5Mg==">Webpack 中的 sideEffects 到底该怎么用？</span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjgzMTE3Mg==">你的 Tree-Shaking 并没什么卵用</span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjE0ODMzOA==">对 webpack 文档的吐槽</span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjU1NDQzNg==">Tree-Shaking 性能优化实践 - 原理篇</span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yOTUwNjY4NQ==">再见，babel-preset-2015</span></li></ul><div class="tags"><a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"><i class="ic i-tag"></i> 前端</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E5%BA%93/" rel="tag"><i class="ic i-tag"></i> 知识库</a> <a href="/tags/webpack/" rel="tag"><i class="ic i-tag"></i> webpack</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-05-07 23:21:37" itemprop="dateModified" datetime="2021-05-07T23:21:37+08:00">2021-05-07</time> </span><span id="web/知识库/webpack4-上/" class="item leancloud_visitors" data-flag-title="webpack4 - 上" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="小兴 微信支付"><p>微信支付</p></div><div><img data-src="/images/paypal.png" alt="小兴 微信名片"><p>微信名片</p></div><div><img data-src="/images/alipay.png" alt="小兴 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>小兴 <i class="ic i-at"><em>@</em></i>卡布奇诺</li><li class="link"><strong>本文链接：</strong> <a href="http://tangsx.com/web/%E7%9F%A5%E8%AF%86%E5%BA%93/webpack4-%E4%B8%8A/" title="webpack4 - 上">http://tangsx.com/web/知识库/webpack4-上/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclh3brzpj20zk0m8ann.jpg" title="前端错误处理"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 知识库</span><h3>前端错误处理</h3></a></div><div class="item right"><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeun65urj20zk0m81ii.jpg" title="垃圾回收"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 知识库</span><h3>垃圾回收</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E7%AF%87"><span class="toc-number">1.</span> <span class="toc-text">升级篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7-webpack"><span class="toc-number">1.2.</span> <span class="toc-text">升级 webpack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">带来的变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.</span> <span class="toc-text">默认配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html-webpack-plugin"><span class="toc-number">2.</span> <span class="toc-text">html-webpack-plugin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mini-css-extract-plugin"><span class="toc-number">3.</span> <span class="toc-text">mini-css-extract-plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-extract-text-webpack-plugin-%E5%8C%BA%E5%88%AB"><span class="toc-number">3.1.</span> <span class="toc-text">与 extract-text-webpack-plugin 区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-number">3.2.</span> <span class="toc-text">压缩与优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#contenthash"><span class="toc-number">3.3.</span> <span class="toc-text">contenthash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E5%86%8D%E7%AE%80%E5%8D%95%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8B%E5%87%A0%E7%A7%8D-hash-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.4.</span> <span class="toc-text">这里再简单说明一下几种 hash 的区别：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0%E9%80%9F%E5%BA%A6"><span class="toc-number">4.</span> <span class="toc-text">热更新速度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E9%80%9F%E5%BA%A6"><span class="toc-number">5.</span> <span class="toc-text">打包速度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tree-shaking"><span class="toc-number">6.</span> <span class="toc-text">Tree-Shaking</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/js%E4%B8%AD%E7%9A%84%E9%80%97%E5%8F%B7/" rel="bookmark" title="js中的逗号">js中的逗号</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/sort/" rel="bookmark" title="sort排序">sort排序</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" rel="bookmark" title="前端错误处理">前端错误处理</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" rel="bookmark" title="垃圾回收">垃圾回收</a></li><li class="active"><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/webpack4-%E4%B8%8A/" rel="bookmark" title="webpack4-上">webpack4-上</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/webpack4-%E4%B8%8B/" rel="bookmark" title="webpack4-下">webpack4-下</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/other/" rel="bookmark" title="其他">其他</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/es6/" rel="bookmark" title="ES6">ES6</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/js%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/" rel="bookmark" title="js注意事项">js注意事项</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/npx/" rel="bookmark" title="npx">npx</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E6%96%87%E7%AB%A0%E6%94%B6%E9%9B%86/" rel="bookmark" title="文章收集">文章收集</a></li><li><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/vue/" rel="bookmark" title="Vue">Vue</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="小兴" data-src="/images/tangsx.png"><p class="name" itemprop="name">小兴</p><div class="description" itemprop="description">世上无难事，只要肯放弃</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">59</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">10</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">18</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RzeC1zdGFycw==" title="https:&#x2F;&#x2F;github.com&#x2F;tsx-stars"><i class="ic i-github"></i></span> <span class="exturl item qq" data-url="dGVuY2VudDovL0FkZENvbnRhY3QvP2Zyb21JZD00NSZmcm9tU3ViSWQ9MSZzdWJjbWQ9YWxsJnVpbj0yMjkwMjA0MDcmd2Vic2l0ZT13d3cub2ljcXpvbmUuY29t" title="tencent:&#x2F;&#x2F;AddContact&#x2F;?fromId&#x3D;45&amp;fromSubId&#x3D;1&amp;subcmd&#x3D;all&amp;uin&#x3D;229020407&amp;website&#x3D;www.oicqzone.com"><i class="ic i-qq"></i></span> <a href="/images/paypal.png" title="&#x2F;images&#x2F;paypal.png" class="item weChat"><i class="ic i-weixin"></i></a> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9jaGVuLXJhbi1saXUtbGktOTg=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;chen-ran-liu-li-98"><i class="ic i-zhihu"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjE3MzQzNjM5NTkzQDE2My5jb20=" title="mailto:17343639593@163.com"><i class="ic i-envelope"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTUwNzQ2Njg5Nw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;507466897"><i class="ic i-cloud-music"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/file" rel="section"><i class="ic i-file"></i>文件</a></li><li class="item"><a href="/album" rel="section"><i class="ic i-chart-area"></i>相册</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-address-card"></i>简历</a><ul class="submenu"><li class="item"><a href="/my-resume/webVersion.html" rel="section"><i class="ic i-star"></i>网页版</a></li><li class="item"><a href="/my-resume/pdfVersion.html" rel="section"><i class="ic i-star"></i>pdf版</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-magic"></i>链环</a><ul class="submenu"><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/website/" rel="section"><i class="ic i-star"></i>网址</a></li></ul></li><li class="item"><span class="exturl" data-url="aHR0cHM6Ly90cmF2ZWxsaW5ncy5ub3cuc2gv"><i class="ic i-paper-plane"></i>开往</span></li><li class="item"><a href="/about" rel="section"><i class="ic i-user"></i>关于</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a></div><span><a href="/web/interview/css/" title="css">css</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" title="分类于 js 专题系列文章">js 专题系列文章</a></div><span><a href="/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E4%B8%93%E9%A2%98%E4%B9%8B%E8%B7%9F%E7%9D%80underscore%E5%AD%A6%E8%8A%82%E6%B5%81/" title="JavaScript专题之跟着underscore学节流">JavaScript专题之跟着underscore学节流</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" title="分类于 js 专题系列文章">js 专题系列文章</a></div><span><a href="/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E4%B8%93%E9%A2%98%E4%B9%8B%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD(%E4%B8%8B)/" title="JavaScript专题之类型判断(下)">JavaScript专题之类型判断(下)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/%E7%9F%A5%E8%AF%86%E5%BA%93/" title="分类于 知识库">知识库</a></div><span><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" title="前端错误处理">前端错误处理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" title="分类于 js 专题系列文章">js 专题系列文章</a></div><span><a href="/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E4%B8%93%E9%A2%98%E4%B9%8B%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88/" title="JavaScript专题之函数组合">JavaScript专题之函数组合</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" title="分类于 js 专题系列文章">js 专题系列文章</a></div><span><a href="/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E4%B8%93%E9%A2%98%E4%B9%8B%E8%B7%9F%E7%9D%80underscore%E5%AD%A6%E9%98%B2%E6%8A%96/" title="JavaScript专题之跟着underscore学防抖">JavaScript专题之跟着underscore学防抖</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/%E7%9F%A5%E8%AF%86%E5%BA%93/" title="分类于 知识库">知识库</a></div><span><a href="/web/%E7%9F%A5%E8%AF%86%E5%BA%93/sort/" title="sort排序">sort排序</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/js%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" title="分类于 js 深入系列文章">js 深入系列文章</a></div><span><a href="/web/js%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E6%B7%B1%E5%85%A5%E4%B9%8B%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E6%A0%88/" title="JavaScript深入之执行上下文栈">JavaScript深入之执行上下文栈</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" title="分类于 js 专题系列文章">js 专题系列文章</a></div><span><a href="/web/js%E4%B8%93%E9%A2%98%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E4%B8%93%E9%A2%98%E4%B9%8B%E9%80%92%E5%BD%92/" title="JavaScript专题之递归">JavaScript专题之递归</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/web/js%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/" title="分类于 js 深入系列文章">js 深入系列文章</a></div><span><a href="/web/js%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/JavaScript%E6%B7%B1%E5%85%A5%E4%B9%8B%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E5%8E%9F%E5%9E%8B%E9%93%BE/" title="JavaScript深入之从原型到原型链">JavaScript深入之从原型到原型链</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright"><span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">小兴 @ stars</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">230k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">3:29</span></div><div class="powered-by">© 2020 tangsx.com 版权所有 <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备19047663号-3</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"web/知识库/webpack4-上/",favicon:{show:"欢迎 (～o￣▽￣)～o ~。。。",hide:"_____λ......___丬 别走啊～～"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?2c233145864c5dc42c6398c6f14c4255";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>